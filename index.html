<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>İşletme Paneli</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>
  <h1>İşletme Bilgileri</h1>

  <form id="businessForm">
    <label>İşletme Adı:</label><br />
    <input type="text" id="name" /><br /><br />

    <label>Google Place ID:</label><br />
    <input type="text" id="placeId" /><br /><br />

    <label>Instagram:</label><br />
    <input type="text" id="instagram" /><br /><br />

    <button type="submit">Kaydet</button>
  </form>

  <script>
    const SUPABASE_URL = "https://cwijtyuquileaznsiqwco.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ..."; // tamamını koy
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const form = document.getElementById("businessForm");

    async function fetchData() {
      const { data, error } = await supabase
        .from("isletmeler")
        .select("*")
        .limit(1)
        .single();

      if (data) {
        document.getElementById("name").value = data.name || "";
        document.getElementById("placeId").value = data.place_id || "";
        document.getElementById("instagram").value = data.instagram || "";
      }
    }

    fetchData();

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const name = document.getElementById("name").value;
      const placeId = document.getElementById("placeId").value;
      const instagram = document.getElementById("instagram").value;

      const { data: existing } = await supabase
        .from("isletmeler")
        .select("*")
        .limit(1)
        .single();

      if (existing) {
        await supabase
          .from("isletmeler")
          .update({ name, place_id: placeId, instagram })
          .eq("id", existing.id);
        alert("Güncellendi!");
      } else {
        await supabase
          .from("isletmeler")
          .insert({ name, place_id: placeId, instagram });
        alert("Kaydedildi!");
      }
    });
  </script>
</body>
</html>