<!DOCTYPE html><html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel</title>
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';const supabaseUrl = 'https://qcrbbvokdkyjjfsgffau.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFjcmJidm9rZGt5ampmc2dmZmF1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUzMTc1MTAsImV4cCI6MjA2MDg5MzUxMH0.TLCqjWowPhDs1s_rQoYFLOKH4iVAc6SV2zECIcPOAfo';
const supabase = createClient(supabaseUrl, supabaseKey);

const kullanici = localStorage.getItem('kullanici');
if (!kullanici) window.location.href = 'index.html';

const menuList = document.getElementById('menu-list');
const kategoriInput = document.getElementById('kategori');
const baslikInput = document.getElementById('baslik');
const icerikInput = document.getElementById('icerik');
const fiyatInput = document.getElementById('fiyat');
const ekleBtn = document.getElementById('ekleBtn');
const kaydetBtn = document.getElementById('kaydetBtn');

async function listele() {
  const { data } = await supabase.from('menuler').select('*');
  menuList.innerHTML = '';
  data.forEach(item => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td><input value="${item.kategori}" /></td>
      <td><input value="${item.baslik}" /></td>
      <td><input value="${item.icerik}" /></td>
      <td><input value="${item.fiyat}" /></td>
      <td><input type="checkbox" class="aktif-checkbox" data-id="${item.id}" ${item.durum ? 'checked' : ''}></td>
    `;
    menuList.appendChild(row);
  });
}

ekleBtn.addEventListener('click', async () => {
  const yeniUrun = {
    kategori: kategoriInput.value,
    baslik: baslikInput.value,
    icerik: icerikInput.value,
    fiyat: parseInt(fiyatInput.value),
    durum: true,
  };

  const { error } = await supabase.from('menuler').insert([yeniUrun]);
  if (error) {
    alert('Ekleme başarısız: ' + error.message);
  } else {
    alert('Ürün eklendi');
    listele();
  }
});

kaydetBtn.addEventListener('click', async () => {
  const checkboxes = document.querySelectorAll('.aktif-checkbox');
  let hata = 0;
  for (const cb of checkboxes) {
    const { error } = await supabase.from('menuler').update({ durum: cb.checked }).eq('id', cb.dataset.id);
    if (error) hata++;
  }
  hata === 0 ? alert('Kaydedildi') : alert('Bazı kayıtlar güncellenemedi');
  listele();
});

listele();

  </script>
  <style>
    body {
      font-family: Arial;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    input[type="text"], input[type="number"] {
      width: 100%;
      padding: 6px;
    }
    button {
      padding: 10px 15px;
      border: none;
      background: #007bff;
      color: white;
      border-radius: 6px;
      margin-top: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>Menü Yönetimi</h2>
  <table>
    <thead>
      <tr>
        <th>Kategori</th>
        <th>Başlık</th>
        <th>İçerik</th>
        <th>Fiyat</th>
        <th>Aktif</th>
      </tr>
    </thead>
    <tbody id="menu-list"></tbody>
  </table>
  <button id="kaydetBtn">Değişiklikleri Kaydet</button>  <h3>Yeni Ürün Ekle</h3>
  <input type="text" id="kategori" placeholder="Kategori" />
  <input type="text" id="baslik" placeholder="Başlık" />
  <input type="text" id="icerik" placeholder="İçerik" />
  <input type="number" id="fiyat" placeholder="Fiyat" />
  <button id="ekleBtn">Ekle</button>
</body>
</html>