<!DOCTYPE html><html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Panel</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: #f1f1f1;
      padding: 20px;
    }h1 {
  text-align: center;
  margin-bottom: 24px;
}

table {
  width: 100%;
  border-collapse: collapse;
  background: #fff;
  border-radius: 8px;
  overflow: hidden;
}

th, td {
  padding: 12px;
  border-bottom: 1px solid #eee;
  text-align: left;
}

th {
  background: #007bff;
  color: white;
}

td input[type="text"], td input[type="number"] {
  width: 100%;
  padding: 6px;
  font-size: 14px;
}

.toggle {
  transform: scale(1.3);
}

.btn {
  background: #28a745;
  color: white;
  padding: 10px 20px;
  border: none;
  border-radius: 6px;
  font-size: 16px;
  margin-top: 20px;
  cursor: pointer;
}

.btn:hover {
  background: #218838;
}

.btn-delete {
  background: #dc3545;
  color: white;
  padding: 6px 10px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

  </style>
</head>
<body>
  <h1>Menü Yönetimi</h1>
  <table id="menu-table">
    <thead>
      <tr>
        <th>Başlık</th>
        <th>Kategori</th>
        <th>İçerik</th>
        <th>Fiyat</th>
        <th>Aktif</th>
        <th>Sil</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button class="btn" onclick="saveChanges()">Kaydet</button>  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js'

    const supabaseUrl = 'https://qcrbbvokdkyjjfsgffau.supabase.co'
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFjcmJidm9rZGt5ampmc2dmZmF1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUzMTc1MTAsImV4cCI6MjA2MDg5MzUxMH0.TLCqjWowPhDs1s_rQoYFLOKH4iVAc6SV2zECIcPOAfo'
    const supabase = createClient(supabaseUrl, supabaseKey)

    const isletme_id = localStorage.getItem('isletme_id') || 'admin'

    async function loadMenu() {
      const { data, error } = await supabase
        .from('menu')
        .select('*')
        .eq('isletme_id', isletme_id)
        .order('id', { ascending: true })

      if (error) return alert('Veri alınırken hata oluştu.')

      const tbody = document.querySelector('#menu-table tbody')
      tbody.innerHTML = ''

      data.forEach(item => {
        const tr = document.createElement('tr')
        tr.innerHTML = `
          <td><input type="text" value="${item.baslik}" data-id="${item.id}" data-field="baslik"></td>
          <td><input type="text" value="${item.kategori}" data-id="${item.id}" data-field="kategori"></td>
          <td><input type="text" value="${item.icerik}" data-id="${item.id}" data-field="icerik"></td>
          <td><input type="number" value="${item.fiyat}" data-id="${item.id}" data-field="fiyat"></td>
          <td><input type="checkbox" class="toggle" ${item.aktif ? 'checked' : ''} data-id="${item.id}" data-field="aktif"></td>
          <td><button class="btn-delete" onclick="deleteItem(${item.id})">Sil</button></td>
        `
        tbody.appendChild(tr)
      })
    }

    async function saveChanges() {
      const inputs = document.querySelectorAll('input[data-id]')
      const updates = {}

      inputs.forEach(input => {
        const id = input.dataset.id
        const field = input.dataset.field
        const value = input.type === 'checkbox' ? input.checked : input.value

        if (!updates[id]) updates[id] = { id }
        updates[id][field] = field === 'fiyat' ? parseFloat(value) : value
      })

      const updatesArray = Object.values(updates)

      for (const item of updatesArray) {
        await supabase
          .from('menu')
          .update(item)
          .eq('id', item.id)
      }

      alert('Değişiklikler kaydedildi ve menü güncellendi.')
      loadMenu()
    }

    async function deleteItem(id) {
      if (!confirm('Bu ürünü silmek istediğinize emin misiniz?')) return

      await supabase
        .from('menu')
        .delete()
        .eq('id', id)

      loadMenu()
    }

    loadMenu()
  </script></body>
</html>